{
  if (isCancelled()) {
    return null;
  }
  TaskCache.waitForMsgDetailPictureDownload(msg,downloadListener);
  String middlePath=FileManager.getFilePathFromUrl(msg.getBmiddle_pic(),FileLocationMethod.picture_bmiddle);
  String largePath=FileManager.getFilePathFromUrl(msg.getOriginal_pic(),FileLocationMethod.picture_large);
  if (new File(largePath).exists()) {
    return largePath;
  }
 else   if (!this.hd && new File(middlePath).exists()) {
    return middlePath;
  }
 else {
    String data=(this.hd ? msg.getOriginal_pic() : msg.getBmiddle_pic());
    FileLocationMethod method=(this.hd ? FileLocationMethod.picture_large : FileLocationMethod.picture_bmiddle);
    return ImageTool.getLargePictureWithoutRoundedCorner(data,downloadListener,method);
  }
}
