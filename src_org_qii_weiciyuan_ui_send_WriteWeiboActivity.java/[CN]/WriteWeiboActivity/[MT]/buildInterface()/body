{
  setContentView(R.layout.writeweiboactivity_layout);
  ActionBar actionBar=getActionBar();
  actionBar.setDisplayHomeAsUpEnabled(true);
  actionBar.setTitle(R.string.write_weibo);
  actionBar.setDisplayShowHomeEnabled(true);
  actionBar.setDisplayShowTitleEnabled(true);
  int avatarWidth=getResources().getDimensionPixelSize(R.dimen.timeline_avatar_width);
  int avatarHeight=getResources().getDimensionPixelSize(R.dimen.timeline_avatar_height);
  Bitmap bitmap=ImageTool.getWriteWeiboRoundedCornerPic(GlobalContext.getInstance().getAccountBean().getInfo().getAvatar_large(),avatarWidth,avatarHeight,FileLocationMethod.avatar_large);
  if (bitmap == null) {
    bitmap=ImageTool.getWriteWeiboRoundedCornerPic(GlobalContext.getInstance().getAccountBean().getInfo().getProfile_image_url(),avatarWidth,avatarHeight,FileLocationMethod.avatar_small);
  }
  if (bitmap != null) {
    actionBar.setIcon(new BitmapDrawable(getResources(),bitmap));
  }
  View title=getLayoutInflater().inflate(R.layout.writeweiboactivity_title_layout,null);
  TextView contentNumber=(TextView)title.findViewById(R.id.content_number);
  contentNumber.setVisibility(View.GONE);
  haveGPS=(ImageView)title.findViewById(R.id.have_gps);
  haveGPS.setOnClickListener(new View.OnClickListener(){
    @Override public void onClick(    View v){
      if (Utility.isGooglePlaySafe(WriteWeiboActivity.this)) {
        Intent intent=new Intent(WriteWeiboActivity.this,AppMapActivity.class);
        intent.putExtra("lat",geoBean.getLat());
        intent.putExtra("lon",geoBean.getLon());
        intent.putExtra("locationStr",location);
        startActivity(intent);
      }
 else {
        StringBuilder geoUriString=new StringBuilder().append("geo:" + geoBean.getLat() + ","+ geoBean.getLon());
        if (!TextUtils.isEmpty(location)) {
          geoUriString.append("?q=").append(location);
        }
        Uri geoUri=Uri.parse(geoUriString.toString());
        Intent mapCall=new Intent(Intent.ACTION_VIEW,geoUri);
        if (Utility.isIntentSafe(WriteWeiboActivity.this,mapCall)) {
          startActivity(mapCall);
        }
      }
    }
  }
);
  haveGPS.setOnLongClickListener(new View.OnLongClickListener(){
    @Override public boolean onLongClick(    View v){
      haveGPS.setVisibility(View.GONE);
      geoBean=null;
      return true;
    }
  }
);
  actionBar.setCustomView(title,new ActionBar.LayoutParams(Gravity.RIGHT));
  actionBar.setDisplayShowCustomEnabled(true);
  content=((KeyboardControlEditText)findViewById(R.id.status_new_content));
  content.addTextChangedListener(new TextNumLimitWatcher((TextView)findViewById(R.id.menu_send),content,this));
  content.setDrawingCacheEnabled(true);
  View.OnClickListener onClickListener=new BottomButtonClickListener();
  findViewById(R.id.menu_at).setOnClickListener(onClickListener);
  findViewById(R.id.menu_emoticon).setOnClickListener(onClickListener);
  findViewById(R.id.menu_add_pic).setOnClickListener(onClickListener);
  findViewById(R.id.menu_send).setOnClickListener(onClickListener);
  View.OnLongClickListener onLongClickListener=new BottomButtonLongClickListener();
  findViewById(R.id.menu_at).setOnLongClickListener(onLongClickListener);
  findViewById(R.id.menu_emoticon).setOnLongClickListener(onLongClickListener);
  findViewById(R.id.menu_add_pic).setOnLongClickListener(onLongClickListener);
  findViewById(R.id.menu_send).setOnLongClickListener(onLongClickListener);
  smiley=(SmileyPicker)findViewById(R.id.smiley_picker);
  smiley.setEditText(content);
  mContainer=(LinearLayout)findViewById(R.id.container);
  content.setOnClickListener(new View.OnClickListener(){
    @Override public void onClick(    View v){
      hideSmileyPicker(true);
    }
  }
);
}
