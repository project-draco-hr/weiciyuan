{
  super.onCreate(savedInstanceState);
  setRetainInstance(false);
  addPreferencesFromResource(R.xml.about_pref);
  findPreference(SettingActivity.SUGGEST).setOnPreferenceClickListener(new Preference.OnPreferenceClickListener(){
    @Override public boolean onPreferenceClick(    Preference preference){
      Intent intent=new Intent(getActivity(),WriteWeiboActivity.class);
      intent.putExtra("token",GlobalContext.getInstance().getSpecialToken());
      intent.putExtra("account",GlobalContext.getInstance().getAccountBean());
      intent.putExtra("content",buildContent());
      startActivity(intent);
      return true;
    }
  }
);
  findPreference(SettingActivity.RECOMMEND).setOnPreferenceClickListener(new Preference.OnPreferenceClickListener(){
    @Override public boolean onPreferenceClick(    Preference preference){
      Intent intent=new Intent(getActivity(),WriteWeiboActivity.class);
      intent.putExtra("token",GlobalContext.getInstance().getSpecialToken());
      intent.putExtra("account",GlobalContext.getInstance().getAccountBean());
      intent.putExtra("content",getString(R.string.recommend_content));
      startActivity(intent);
      return true;
    }
  }
);
  findPreference(SettingActivity.VERSION).setSummary(buildVersionInfo());
  findPreference(SettingActivity.VERSION).setOnPreferenceClickListener(new Preference.OnPreferenceClickListener(){
    @Override public boolean onPreferenceClick(    Preference preference){
      ChangeLogDialog changeLogDialog=new ChangeLogDialog(getActivity());
      changeLogDialog.show();
      return true;
    }
  }
);
  if (getResources().getBoolean(R.bool.blackmagic)) {
    Runtime rt=Runtime.getRuntime();
    long vmAlloc=rt.totalMemory() - rt.freeMemory();
    long nativeAlloc=Debug.getNativeHeapAllocatedSize();
    String vmAllocStr="VM Allocated " + formatMemoryText(vmAlloc);
    String nativeAllocStr="Native Allocated " + formatMemoryText(nativeAlloc);
    ActivityManager am=(ActivityManager)getActivity().getSystemService(Context.ACTIVITY_SERVICE);
    int memoryClass=am.getMemoryClass();
    String result="VM Max " + Integer.toString(memoryClass) + "MB";
    findPreference(SettingActivity.DEBUG_MEM_INFO).setSummary(vmAllocStr + "," + nativeAllocStr+ ","+ result);
  }
  findPreference(SettingActivity.AUTHOR).setOnPreferenceClickListener(new Preference.OnPreferenceClickListener(){
    @Override public boolean onPreferenceClick(    Preference preference){
      if (mp != null && mp.isPlaying()) {
        mp.stop();
        playing=false;
        return true;
      }
      if (mp == null || !playing) {
        mp=MediaPlayer.create(getActivity(),R.raw.star);
      }
      mp.start();
      playing=true;
      Toast.makeText(getActivity(),"???????????????",Toast.LENGTH_SHORT).show();
      return true;
    }
  }
);
  buildCacheSummary();
  buildLogSummary();
  findPreference(SettingActivity.SAVED_PIC_PATH).setSummary(Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES).getAbsolutePath());
}
