{
  if (!isExternalStorageMounted())   return "";
  if (TextUtils.isEmpty(url))   return "";
  int index=url.indexOf("//");
  String s=url.substring(index + 2);
  String oldRelativePath=s.substring(s.indexOf("/"));
  String newRelativePath="";
switch (method) {
case avatar_small:
    newRelativePath=File.separator + AVATAR_SMAll + oldRelativePath;
  break;
case avatar_large:
newRelativePath=File.separator + AVATAR_LARGE + oldRelativePath;
break;
case picture_thumbnail:
newRelativePath=File.separator + PICTURE_THUMBNAIL + oldRelativePath;
break;
case picture_bmiddle:
newRelativePath=File.separator + PICTURE_BMIDDLE + oldRelativePath;
break;
case picture_large:
newRelativePath=File.separator + PICTURE_LARGE + oldRelativePath;
break;
case emotion:
String name=new File(oldRelativePath).getName();
newRelativePath=File.separator + EMOTION + File.separator+ name;
break;
}
String result=getSdCardPath() + File.separator + newRelativePath;
if (!result.endsWith(".jpg") && !result.endsWith(".gif")) result=result + ".jpg";
return result;
}
