{
  mImageView=new WeakReference<ImageView>(imageView);
  imageView.setOnTouchListener(this);
  mViewTreeObserver=imageView.getViewTreeObserver();
  mViewTreeObserver.addOnGlobalLayoutListener(this);
  setImageViewScaleTypeMatrix(imageView);
  if (!imageView.isInEditMode()) {
    mScaleDragDetector=VersionedGestureDetector.newInstance(imageView.getContext(),this);
    mGestureDetector=new GestureDetector(imageView.getContext(),new GestureDetector.SimpleOnGestureListener(){
      @Override public void onLongPress(      MotionEvent e){
        if (null != mLongClickListener) {
          mLongClickListener.onLongClick(mImageView.get());
        }
      }
    }
);
    mGestureDetector.setOnDoubleTapListener(this);
    setZoomable(true);
  }
}
