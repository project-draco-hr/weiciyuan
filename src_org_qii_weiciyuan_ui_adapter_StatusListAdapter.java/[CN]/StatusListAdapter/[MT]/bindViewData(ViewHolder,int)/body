{
  Drawable drawable=bg.get(holder);
  if (drawable != null) {
    holder.listview_root.setBackgroundDrawable(drawable);
  }
 else {
    drawable=holder.listview_root.getBackground();
    bg.put(holder,drawable);
  }
  if (listView.getCheckedItemPosition() == position + 1)   holder.listview_root.setBackgroundColor(checkedBG);
  final MessageBean msg=bean.get(position);
  UserBean user=msg.getUser();
  if (user != null) {
    holder.username.setVisibility(View.VISIBLE);
    if (!TextUtils.isEmpty(user.getRemark())) {
      holder.username.setText(new StringBuilder(user.getScreen_name()).append("(").append(user.getRemark()).append(")").toString());
    }
 else {
      holder.username.setText(user.getScreen_name());
    }
    if (!showOriStatus && !SettingUtility.getEnableCommentRepostListAvatar()) {
      holder.avatar.setLayoutParams(new RelativeLayout.LayoutParams(0,0));
    }
 else {
      buildAvatar(holder.avatar,position,user);
    }
  }
 else {
    holder.username.setVisibility(View.INVISIBLE);
    holder.avatar.setVisibility(View.INVISIBLE);
  }
  if (!TextUtils.isEmpty(msg.getListViewSpannableString())) {
    boolean d=msgHeights.containsKey(msg.getId());
    ViewGroup.LayoutParams layoutParams=holder.content.getLayoutParams();
    if (d) {
      layoutParams.height=msgHeights.get(msg.getId());
    }
 else {
      layoutParams.height=ViewGroup.LayoutParams.WRAP_CONTENT;
    }
    boolean c=msgWidths.containsKey(msg.getId());
    if (c) {
      layoutParams.width=msgWidths.get(msg.getId());
    }
 else {
      layoutParams.width=ViewGroup.LayoutParams.WRAP_CONTENT;
    }
    holder.content.requestLayout();
    holder.content.setText(msg.getListViewSpannableString());
    if (!d) {
      msgHeights.put(msg.getId(),layoutParams.height);
    }
    if (!c) {
      msgWidths.put(msg.getId(),layoutParams.width);
    }
  }
 else {
    ListViewTool.addJustHighLightLinks(msg);
    holder.content.setText(msg.getListViewSpannableString());
  }
  holder.listview_root.setOnClickListener(new View.OnClickListener(){
    @Override public void onClick(    View v){
      if (!((AbstractTimeLineFragment)fragment).clearActionModeIfOpen()) {
        Intent intent=new Intent(getActivity(),BrowserWeiboMsgActivity.class);
        intent.putExtra("msg",msg);
        intent.putExtra("token",GlobalContext.getInstance().getSpecialToken());
        fragment.startActivityForResult(intent,0);
      }
    }
  }
);
  holder.username.setOnTouchListener(new View.OnTouchListener(){
    @Override public boolean onTouch(    View v,    MotionEvent event){
      holder.listview_root.onTouchEvent(event);
      return false;
    }
  }
);
  holder.time.setOnTouchListener(new View.OnTouchListener(){
    @Override public boolean onTouch(    View v,    MotionEvent event){
      holder.listview_root.onTouchEvent(event);
      return false;
    }
  }
);
  View.OnTouchListener onTouchListener=new View.OnTouchListener(){
    @Override public boolean onTouch(    View v,    MotionEvent event){
      TextView tv=(TextView)v;
      int start=tv.getSelectionStart();
      int end=tv.getSelectionEnd();
      SpannableString completeText=(SpannableString)((TextView)v).getText();
      boolean isNotLink=start == -1 || end == -1;
switch (event.getActionMasked()) {
case MotionEvent.ACTION_UP:
        if (isNotLink && completeText.getSpanStart(this) == -1) {
          holder.listview_root.dispatchTouchEvent(MotionEvent.obtain(SystemClock.uptimeMillis(),SystemClock.uptimeMillis(),MotionEvent.ACTION_DOWN,0,0,0));
          holder.listview_root.dispatchTouchEvent(MotionEvent.obtain(SystemClock.uptimeMillis(),SystemClock.uptimeMillis(),MotionEvent.ACTION_UP,0,0,0));
        }
      break;
  }
  return false;
}
}
;
holder.content.setOnTouchListener(onTouchListener);
holder.repost_content.setOnTouchListener(onTouchListener);
if (holder.content.getMovementMethod() != MyLinkMovementMethod.getInstance()) holder.content.setMovementMethod(MyLinkMovementMethod.getInstance());
if (holder.repost_content.getMovementMethod() != MyLinkMovementMethod.getInstance()) holder.repost_content.setMovementMethod(MyLinkMovementMethod.getInstance());
holder.time.setTime(msg.getMills());
if (showOriStatus) {
boolean checkRepostsCount=(msg.getReposts_count() != 0);
boolean checkCommentsCount=(msg.getComments_count() != 0);
boolean checkPic=(!TextUtils.isEmpty(msg.getThumbnail_pic()) || (msg.getRetweeted_status() != null && !TextUtils.isEmpty(msg.getRetweeted_status().getThumbnail_pic())));
checkPic=(checkPic && !SettingUtility.isEnablePic());
boolean checkGps=(msg.getGeo() != null);
if (!checkRepostsCount && !checkCommentsCount && !checkPic&& !checkGps) {
  holder.count_layout.setVisibility(View.GONE);
}
 else {
  holder.count_layout.setVisibility(View.VISIBLE);
  if (checkPic) {
    holder.timeline_pic.setVisibility(View.VISIBLE);
  }
 else {
    holder.timeline_pic.setVisibility(View.GONE);
  }
  if (checkGps) {
    holder.timeline_gps.setVisibility(View.VISIBLE);
  }
 else {
    holder.timeline_gps.setVisibility(View.GONE);
  }
  if (checkRepostsCount) {
    holder.repost_count.setText(String.valueOf(msg.getReposts_count()));
    holder.repost_count.setVisibility(View.VISIBLE);
  }
 else {
    holder.repost_count.setVisibility(View.GONE);
  }
  if (checkCommentsCount) {
    holder.comment_count.setText(String.valueOf(msg.getComments_count()));
    holder.comment_count.setVisibility(View.VISIBLE);
  }
 else {
    holder.comment_count.setVisibility(View.GONE);
  }
}
}
holder.repost_content.setVisibility(View.GONE);
holder.repost_content_pic.setVisibility(View.GONE);
holder.content_pic.setVisibility(View.GONE);
if (!TextUtils.isEmpty(msg.getThumbnail_pic())) {
buildPic(msg,holder.content_pic,position);
}
MessageBean repost_msg=msg.getRetweeted_status();
if (repost_msg != null && showOriStatus) {
if (holder.repost_layout != null) holder.repost_layout.setVisibility(View.VISIBLE);
holder.repost_flag.setVisibility(View.VISIBLE);
if (holder.content_pic.getVisibility() != View.GONE) holder.content_pic.setVisibility(View.GONE);
buildRepostContent(msg,repost_msg,holder,position);
}
 else {
if (holder.repost_layout != null) holder.repost_layout.setVisibility(View.GONE);
holder.repost_flag.setVisibility(View.GONE);
}
}
