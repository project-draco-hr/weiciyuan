{
  long now=System.currentTimeMillis();
  long msg=time;
  Calendar nowCalendar=Calendar.getInstance();
  Calendar msgCalendar=Calendar.getInstance();
  msgCalendar.setTimeInMillis(time);
  long calcMills=now - msg;
  long calSeconds=calcMills / 1000;
  if (calSeconds < 60) {
    return JUST_NOW;
  }
  long calMins=calSeconds / 60;
  if (calMins < 60) {
    return new StringBuilder().append(calMins).append(MIN).toString();
  }
  long calHours=calMins / 60;
  if (calHours < 24 && isSameDay(nowCalendar,msgCalendar)) {
    java.text.SimpleDateFormat format=new java.text.SimpleDateFormat("HH:mm");
    String result=format.format(msgCalendar.getTime());
    return new StringBuilder().append(TODAY).append(" ").append(result).toString();
  }
  long calDay=calHours / 24;
  if (calDay < 31) {
    if (isYesterDay(nowCalendar,msgCalendar)) {
      java.text.SimpleDateFormat format=new java.text.SimpleDateFormat("HH:mm");
      String result=format.format(msgCalendar.getTime());
      return new StringBuilder(YESTER_DAY).append(" ").append(result).toString();
    }
 else     if (isTheDayBeforeYesterDay(nowCalendar,msgCalendar)) {
      java.text.SimpleDateFormat format=new java.text.SimpleDateFormat("HH:mm");
      String result=format.format(msgCalendar.getTime());
      return new StringBuilder(THE_DAY_BEFORE_YESTER_DAY).append(" ").append(result).toString();
    }
 else {
      java.text.SimpleDateFormat format=new java.text.SimpleDateFormat("MM-dd HH:mm");
      String result=format.format(msgCalendar.getTime());
      return new StringBuilder(result).toString();
    }
  }
  long calMonth=calDay / 31;
  if (calMonth < 12) {
    java.text.SimpleDateFormat format=new java.text.SimpleDateFormat("MM-dd HH:mm");
    String result=format.format(msgCalendar.getTime());
    return new StringBuilder().append(result).toString();
  }
  java.text.SimpleDateFormat format=new java.text.SimpleDateFormat("yyyy-MM-dd HH:mm");
  String result=format.format(msgCalendar.getTime());
  return new StringBuilder().append(result).toString();
}
