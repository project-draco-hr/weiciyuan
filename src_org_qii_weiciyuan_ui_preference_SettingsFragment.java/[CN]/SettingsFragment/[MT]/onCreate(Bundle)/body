{
  super.onCreate(savedInstanceState);
  addPreferencesFromResource(R.xml.pref);
  getPreferenceScreen().getSharedPreferences().registerOnSharedPreferenceChangeListener(this);
  clear_cache=findPreference(SettingActivity.CLEAR_CACHE);
  clear_cache.setOnPreferenceClickListener(new Preference.OnPreferenceClickListener(){
    @Override public boolean onPreferenceClick(    Preference preference){
      RemoveCacheDialog dialog=new RemoveCacheDialog();
      dialog.setTargetFragment(SettingsFragment.this,0);
      dialog.show(getFragmentManager(),"");
      return true;
    }
  }
);
  calcTask=new CalcCacheSize();
  calcTask.executeOnExecutor(MyAsyncTask.THREAD_POOL_EXECUTOR);
  findPreference(SettingActivity.OFFICIAL_WEIBO).setOnPreferenceClickListener(new Preference.OnPreferenceClickListener(){
    @Override public boolean onPreferenceClick(    Preference preference){
      UserBean bean=new UserBean();
      bean.setScreen_name(getString(R.string.official_weibo_link));
      String token=GlobalContext.getInstance().getSpecialToken();
      Intent intent=new Intent(getActivity(),UserInfoActivity.class);
      intent.putExtra("token",token);
      intent.putExtra("user",bean);
      startActivity(intent);
      return true;
    }
  }
);
  findPreference(SettingActivity.DOWNLOAD_EMOTIONS).setOnPreferenceClickListener(new Preference.OnPreferenceClickListener(){
    @Override public boolean onPreferenceClick(    Preference preference){
      Intent service=new Intent(getActivity(),DownloadEmotionsService.class);
      service.putExtra("token",GlobalContext.getInstance().getSpecialToken());
      getActivity().startService(service);
      return true;
    }
  }
);
}
