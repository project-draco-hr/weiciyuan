{
  ListAdapter adapter=mRefreshableView.getAdapter();
  if (!getShowViewWhileRefreshing() || null == adapter || adapter.isEmpty()) {
    super.setRefreshingInternal(doScroll);
    return;
  }
  super.setRefreshingInternal(false);
  final LoadingLayout originalLoadingLayout, listViewLoadingLayout;
  final int selection, scrollToY;
switch (getCurrentMode()) {
case PULL_UP_TO_REFRESH:
    originalLoadingLayout=getFooterLayout();
  listViewLoadingLayout=mFooterLoadingView;
selection=mRefreshableView.getCount() - 1;
scrollToY=getScrollY() - getHeaderHeight();
break;
case PULL_DOWN_TO_REFRESH:
default :
originalLoadingLayout=getHeaderLayout();
listViewLoadingLayout=mHeaderLoadingView;
selection=0;
scrollToY=getScrollY() + getHeaderHeight();
break;
}
if (doScroll) {
setHeaderScroll(scrollToY);
}
originalLoadingLayout.setVisibility(View.INVISIBLE);
listViewLoadingLayout.setVisibility(View.VISIBLE);
listViewLoadingLayout.refreshing();
if (doScroll) {
mRefreshableView.setSelection(selection);
smoothScrollTo(0);
}
}
